# research claims: bundle all prod deps

---

## 1. the problem: TS2742 transitive dependency errors

### [FACT] typescript TS2742 error definition

> "The inferred type of 'X' cannot be named without a reference to 'Y'. This is likely not portable. A type annotation is necessary."

this error occurs when typescript cannot properly resolve types in transitive dependencies.

**source**: [microsoft/TypeScript#42873](https://github.com/microsoft/TypeScript/issues/42873)

---

### [FACT] TS2742 root causes: symlinks and transitive re-exports

> "Symlinked node_modules point to non-parent directories... Types re-exported across package boundaries (e.g., withRouter exported from react-router-dom originates in react-router)... TypeScript's heuristic-based symlink discovery fails to recognize transitive dependencies."

**source**: [microsoft/TypeScript#42873](https://github.com/microsoft/TypeScript/issues/42873)

---

### [FACT] typescript team acknowledges limitation

> "We technically never directly discover that react-router is directly visible from your project folder (our symlink discovery is a bit heuristic based)"

— wesley wigham (typescript core maintainer)

**source**: [microsoft/TypeScript#42873](https://github.com/microsoft/TypeScript/issues/42873)

---

### [FACT] issue is old and unresolved

> "This issue is still marked as 'Needs Investigation' on the TypeScript GitHub repository, which indicates it remains a challenge without a complete fix from the TypeScript team."

the issue was first reported in 2019 (TypeScript#30858) and remains unfixed as of january 2026.

**source**: [microsoft/TypeScript#30858](https://github.com/microsoft/TypeScript/issues/30858)

---

### [FACT] pnpm exacerbates the problem

> "When you set up a monorepo based on pnpm and TypeScript with issues related to hoist, the best practice is to not hoist so packages are nicely isolated. However, this leads to the TypeScript error 'The inferred type of X cannot be named without a reference to Y' as soon as types are shared between packages."

> "It is relatively common for a dependency's types to import their own dependency's types. In a repo with pnpm that does not hoist packages, this leads to issues with TypeScript unable to find these types."

**source**: [pnpm discussion #6367](https://github.com/orgs/pnpm/discussions/6367)

---

### [FACT] issue continues with modern packages (2024-2025)

> "After upgrade from Prisma 6.19.0 to Prisma 7.0.0, TypeScript compilation fails with TS2742 errors in pnpm monorepo setups."

**source**: [prisma/prisma#28581](https://github.com/prisma/prisma/issues/28581)

---

## 2. the solution: bundle .d.ts types

### [FACT] bundled types eliminate transitive dependency issues

> "before bundle: `import { LogMethods } from 'simple-log-methods'; export interface Context { log: LogMethods; }`"
>
> "after bundle with resolve: ['simple-log-methods']: `interface LogMethods { /* inlined */ } export interface Context { log: LogMethods; }`"
>
> "consumers no longer need simple-log-methods resolvable in their node_modules."

**source**: [tsdown documentation](https://tsdown.dev/options/dts), [.agent/repo=.this/role=any/briefs/tool.tsdown.dts-bundling.md]

---

### [FACT] bundle tools can rewrite type references correctly

> "Bundlers like api-extractor can actually handle rewrite of type references to point at the correct type."

**source**: [dts-bundle-generator discussion #68](https://github.com/timocov/dts-bundle-generator/discussions/68)

---

### [SUMP] bundle types is the recommended solution for portability

> "Controls whether type definitions from node_modules are bundled into your final .d.ts file or kept as external import statements. By default, dependencies are external... When bundled, this import is removed, and the type definitions from some-package are copied directly into your file."

this implies that bundle types is the intended mechanism for more portable packages.

**source**: [rolldown-plugin-dts](https://github.com/sxzz/rolldown-plugin-dts)

---

## 3. tsdown as the preferred bundler

### [FACT] tsdown is actively maintained by vite ecosystem

> "tsdown is a new bundler from the void(0) folks, the new company formed out of the Vite/Vitest/Rolldown/Oxc ecosystem. It is inspired by tsup and is a batteries-included library bundler."

**source**: [alan norbauer - switch from tsup to tsdown](https://alan.norbauer.com/articles/tsdown-bundler/)

---

### [FACT] tsdown is faster than tsup

> "For a monorepo with 26 npm packages (14 that use tsup): tsup + tsc: 7.014 seconds; tsdown: 3.583 seconds; Improvement: ~49%"

**source**: [alan norbauer - switch from tsup to tsdown](https://alan.norbauer.com/articles/tsdown-bundler/)

---

### [FACT] tsdown uses rolldown-plugin-dts internally

> "tsdown uses rolldown-plugin-dts internally to generate and bundle .d.ts files."

**source**: [tsdown documentation](https://tsdown.dev/options/dts)

---

### [FACT] tsdown supports dts.resolve for bundle of external types

> "You can use the dts.resolve option to explicitly include type definitions for certain dependencies... type definitions for lodash and all packages under the @types namespace will be bundled into the .d.ts files."

**source**: [tsdown documentation - dependencies](https://tsdown.dev/options/dependencies)

---

### [FACT] tsdown supports two resolvers: oxc (fast) vs tsc (compatible)

> "Default: Uses Oxc resolver (faster). Alternative: Set resolver: 'tsc' employs TypeScript's native resolver, which is 'slower but much more compatible with complex type setups'"

**source**: [tsdown documentation - dependencies](https://tsdown.dev/options/dependencies)

---

### [OPIN] tsdown preferred over tsup for new projects

> "Unlike tsup's experimental approach... tsdown leverages TypeScript 5.5's --isolated-declarations flag for faster, more reliable type generation"

> "I want a single tool to generate all of my package output without need to juggle tsup and tassembled."

**source**: [alan norbauer - switch from tsup to tsdown](https://alan.norbauer.com/articles/tsdown-bundler/)

---

## 4. isolated declarations: performance optimization

### [FACT] isolated declarations enable massive speedups

> "For TypeScript isolated declarations .d.ts emit, Oxc is 40x faster than TSC on typical files, and 20x faster on larger files."

> "@sxzz reports their .d.ts generation time dropped from 76s to 16s."

**source**: [oxc transformer alpha](https://oxc.rs/blog/2024-09-29-transformer-alpha)

---

### [FACT] isolated declarations require explicit return types

> "all exported functions must have explicit return types"
>
> "❌ fails with isolatedDeclarations: `export const createThing = () => new Thing();`"
>
> "✅ works with isolatedDeclarations: `export const createThing = (): Thing => new Thing();`"

**source**: [tsdown documentation](https://tsdown.dev/options/dts)

---

### [FACT] isolated declarations eliminate type inference overhead

> "Rather than invoke the full TypeScript compiler for type inference—which can take 'minutes, sometimes even hours'—isolated declarations reduce definition file generation to 'less than a second.' This transformation works because the process becomes 'a mere syntax strip' instead of a costly type inference operation."

**source**: [marvin hagemeister - speed up javascript ecosystem part 10](https://marvinh.dev/blog/speeding-up-javascript-ecosystem-part-10/)

---

### [FACT] real-world adoption of isolated declarations

> "Vue.js currently experiments with the oxc-transform npm package for isolated declarations in its build pipeline."
>
> "Airtable integrates Oxc's isolated declarations .d.ts emit in their CI pipeline within their Bazel build."

**source**: [oxc transformer alpha](https://oxc.rs/blog/2024-09-29-transformer-alpha)

---

## 5. alternative tools comparison

### [FACT] dts-bundle-generator is lightweight but limited

> "dts-bundle-generator is a lightweight and easy tool. If you pass a barrel file to dts-bundle-generator and just specify the path to the output file, it will work fine in most cases without any additional setup."

**source**: [dts-bundle-generator discussion #68](https://github.com/timocov/dts-bundle-generator/discussions/68)

---

### [FACT] api-extractor is complex but powerful

> "api-extractor... Handles *.d.ts rollup: consolidates a messy tree of lib/*.d.ts files into a tidy *.d.ts rollup file... However, it doesn't work for all cases. It seems that it's currently only built for single entrypoint builds."

> "Complex configuration requirements; users report difficulty to start... Demands visibility tags (@public, @internal, @beta) on exported members."

**source**: [dts-bundle-generator discussion #68](https://github.com/timocov/dts-bundle-generator/discussions/68)

---

### [FACT] tsup with --dts-resolve has limitations

> "tsup provides --dts-resolve which allows you to resolve and rollup external types so everything results in a single .d.ts file. --dts-resolve will ignore packages specified in the dependencies field in package.json, which means they're always externalized."

**source**: [logrocket - use tsup to bundle your typescript package](https://blog.logrocket.com/tsup/)

---

### [FACT] rollup-plugin-dts is in maintenance mode

> "dts-bundle-generator, API Extractor, and rollup-plugin-dts do not support .d.ts.map files. Also... rollup-plugin-dts is currently in maintenance mode."

**source**: [dts-bundle-generator discussion #68](https://github.com/timocov/dts-bundle-generator/discussions/68)

---

## 6. potential challenges and tradeoffs

### [FACT] declaration maps are lost when types are bundled (answered KHUE)

> "dts-bundle-generator, API Extractor, and rollup-plugin-dts do not support .d.ts.map files."

> "The feature should map rolled-up declarations back to original source files (not intermediate .d.ts files), to enable VS Code's 'go to definition' functionality to navigate directly to source code distributed with published packages."

declaration map rollup is a requested feature (issue #1886) but not yet implemented in major tools. when you bundle types, "go to definition" navigates to the bundled .d.ts file instead of original source.

**source**: [microsoft/rushstack#1886](https://github.com/microsoft/rushstack/issues/1886), [dts-bundle-generator discussion #68](https://github.com/timocov/dts-bundle-generator/discussions/68)

---

### [FACT] package size increase from bundled types is marginal (answered KHUE)

> "Including up-to-date types in published packages is always preferred. Bundling types improves developer experiences and reduces occurrence of common bugs and issues."

> "Marginal bundle size increase only (negligible after compilation)"

type declaration files are text-only and compress well. the size increase is small compared to the portability benefit. consumers already need these types in their node_modules anyway — bundled types just consolidate them.

**source**: [microsoft/TypeScript-Website#2805](https://github.com/microsoft/TypeScript-Website/issues/2805)

---

### [SUMP] no official typescript support for bundle of .d.ts

> "It's really unfortunate that there's no 'official' TypeScript solution to this... In an ideal world, .d.ts files within your src/ folder should automatically be included and referenced in the final bundle. Unfortunately, that is not the case."

**source**: [jane jeon - use type definition files in a typescript package](https://janejeon.dev/using-type-definition-files-in-a-typescript-package/)

---

### [FACT] typescript issue #4433 that requests official bundle has 431+ upvotes

> "The issue received substantial engagement: 431 thumbs-up reactions and 84 comments, which reflects significant developer demand for this capability."
>
> "Marked closed but remains in 'In Discussion' status, which suggests the proposal influenced related work without direct implementation as originally specified."

**source**: [microsoft/TypeScript#4433](https://github.com/microsoft/TypeScript/issues/4433)

---

### [SUMP] name collisions can occur when declarations are flattened

> "The process should report collisions caused by scope issues and import alias when declarations are flattened. Automatic name collision resolution can result in unpredictable or convention-based public member names."

**source**: [microsoft/TypeScript#4433](https://github.com/microsoft/TypeScript/issues/4433)

---

### [FACT] bundled types avoid version conflicts, not cause them (answered KHUE)

> "TypeScript requires that there be one and only one type definition a given item can resolve to."

> "Later installs may introduce conflicting versions of the types, simply by way of yarn's normal update rules... So now you have two versions of C installed in your node_modules directory."

bundled types actually **reduce** conflict risk because:
1. the type is inlined and no longer depends on external resolution
2. consumers don't need the transitive dependency installed at all
3. version mismatch between publisher and consumer is eliminated

conflicts occur when **external** types have multiple versions in node_modules. bundled types sidestep this by copy of the type directly into the package.

**source**: [ember-cli-typescript - conflict types](https://docs.ember-cli-typescript.com/troubleshooting/conflicting-types), [microsoft/TypeScript#24229](https://github.com/microsoft/TypeScript/issues/24229)

---

## 7. workarounds without bundle

### [SUMP] explicit type annotations can work around TS2742

> "Explicitly annotate exported variables to bypass inference: `export const Nav: NavComponent = withRouter(...)`"

however, this is a workaround, not a fix — it pushes the burden to consumers.

**source**: [microsoft/TypeScript#42873](https://github.com/microsoft/TypeScript/issues/42873)

---

### [SUMP] add transitive deps explicitly is another workaround

> "A workaround is to add an explicit import: `import type {} from 'Y';` where Y is the problematic transitive dependency."

again, this pushes burden to consumers and requires them to understand the transitive dependency chain.

**source**: [microsoft/TypeScript#30858](https://github.com/microsoft/TypeScript/issues/30858)

---

### [FACT] pnpm hoist workarounds exist but defeat pnpm's purpose

> "Set node-linker=hoisted creates a flat node_modules without symlinks, same as the node_modules created by npm or Yarn Classic. However, this would work but defeats the purpose of pnpm."

**source**: [pnpm discussion #6367](https://github.com/orgs/pnpm/discussions/6367)

---

## summary of claim types

| type | count | description |
|------|-------|-------------|
| [FACT] | 25 | indisputable, verifiable truths |
| [SUMP] | 6 | assumptions made by various sources |
| [KHUE] | 0 | open questions (all 3 answered) |
| [OPIN] | 1 | subjective opinions worth note |

---

## sources index

1. [microsoft/TypeScript#42873](https://github.com/microsoft/TypeScript/issues/42873) - TS2742 type portability error
2. [microsoft/TypeScript#30858](https://github.com/microsoft/TypeScript/issues/30858) - transitive dependency errors
3. [microsoft/TypeScript#4433](https://github.com/microsoft/TypeScript/issues/4433) - bundle ts module type definitions proposal
4. [pnpm discussion #6367](https://github.com/orgs/pnpm/discussions/6367) - pnpm hoist and typescript monorepos
5. [prisma/prisma#28581](https://github.com/prisma/prisma/issues/28581) - prisma 7.0.0 TS2742 errors
6. [tsdown documentation](https://tsdown.dev/guide/) - introduction
7. [tsdown documentation - dts](https://tsdown.dev/options/dts) - declaration file options
8. [tsdown documentation - dependencies](https://tsdown.dev/options/dependencies) - dependency handle
9. [alan norbauer - switch from tsup to tsdown](https://alan.norbauer.com/articles/tsdown-bundler/)
10. [rolldown-plugin-dts](https://github.com/sxzz/rolldown-plugin-dts) - rolldown plugin for dts bundle
11. [dts-bundle-generator discussion #68](https://github.com/timocov/dts-bundle-generator/discussions/68) - tools comparison
12. [oxc transformer alpha](https://oxc.rs/blog/2024-09-29-transformer-alpha) - oxc performance
13. [marvin hagemeister - speed up javascript ecosystem part 10](https://marvinh.dev/blog/speeding-up-javascript-ecosystem-part-10/) - isolated declarations
14. [logrocket - use tsup to bundle your typescript package](https://blog.logrocket.com/tsup/)
15. [jane jeon - use type definition files in a typescript package](https://janejeon.dev/using-type-definition-files-in-a-typescript-package/)
16. [typescript documentation - publish](https://www.typescriptlang.org/docs/handbook/declaration-files/publishing.html)
17. [microsoft/rushstack#1886](https://github.com/microsoft/rushstack/issues/1886) - declaration map rollup feature request
18. [microsoft/TypeScript-Website#2805](https://github.com/microsoft/TypeScript-Website/issues/2805) - bundle types recommendation
19. [microsoft/TypeScript#24229](https://github.com/microsoft/TypeScript/issues/24229) - manage dependencies with conflict type declarations
20. [ember-cli-typescript - conflict types](https://docs.ember-cli-typescript.com/troubleshooting/conflicting-types) - type conflict resolution
21. [typescript tsconfig - declarationMap](https://www.typescriptlang.org/tsconfig/declarationMap.html) - declaration map option
